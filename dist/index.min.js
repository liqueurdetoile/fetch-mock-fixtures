!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("sinon"));else if("function"==typeof define&&define.amd)define(["sinon"],e);else{var r="object"==typeof exports?e(require("sinon")):e(t.sinon);for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,function(t){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e,r){"use strict";(function(e){var n=r(4),s=r(5),i=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,a=[["#","hash"],["?","query"],function(t){return t.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],u={hash:1,query:1};function l(t){var r,n=("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{}).location||{},s={},i=typeof(t=t||n);if("blob:"===t.protocol)s=new p(unescape(t.pathname),{});else if("string"===i)for(r in s=new p(t,{}),u)delete s[r];else if("object"===i){for(r in t)r in u||(s[r]=t[r]);void 0===s.slashes&&(s.slashes=o.test(t.href))}return s}function h(t){var e=i.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],rest:e[3]}}function p(t,e,r){if(!(this instanceof p))return new p(t,e,r);var i,o,u,c,f,d,y=a.slice(),g=typeof e,w=this,x=0;for("object"!==g&&"string"!==g&&(r=e,e=null),r&&"function"!=typeof r&&(r=s.parse),e=l(e),i=!(o=h(t||"")).protocol&&!o.slashes,w.slashes=o.slashes||i&&e.slashes,w.protocol=o.protocol||e.protocol||"",t=o.rest,o.slashes||(y[3]=[/(.*)/,"pathname"]);x<y.length;x++)"function"!=typeof(c=y[x])?(u=c[0],d=c[1],u!=u?w[d]=t:"string"==typeof u?~(f=t.indexOf(u))&&("number"==typeof c[2]?(w[d]=t.slice(0,f),t=t.slice(f+c[2])):(w[d]=t.slice(f),t=t.slice(0,f))):(f=u.exec(t))&&(w[d]=f[1],t=t.slice(0,f.index)),w[d]=w[d]||i&&c[3]&&e[d]||"",c[4]&&(w[d]=w[d].toLowerCase())):t=c(t);r&&(w.query=r(w.query)),i&&e.slashes&&"/"!==w.pathname.charAt(0)&&(""!==w.pathname||""!==e.pathname)&&(w.pathname=function(t,e){for(var r=(e||"/").split("/").slice(0,-1).concat(t.split("/")),n=r.length,s=r[n-1],i=!1,o=0;n--;)"."===r[n]?r.splice(n,1):".."===r[n]?(r.splice(n,1),o++):o&&(0===n&&(i=!0),r.splice(n,1),o--);return i&&r.unshift(""),"."!==s&&".."!==s||r.push(""),r.join("/")}(w.pathname,e.pathname)),n(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(c=w.auth.split(":"),w.username=c[0]||"",w.password=c[1]||""),w.origin=w.protocol&&w.host&&"file:"!==w.protocol?w.protocol+"//"+w.host:"null",w.href=w.toString()}p.prototype={set:function(t,e,r){var i=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(r||s.parse)(e)),i[t]=e;break;case"port":i[t]=e,n(e,i.protocol)?e&&(i.host=i.hostname+":"+e):(i.host=i.hostname,i[t]="");break;case"hostname":i[t]=e,i.port&&(e+=":"+i.port),i.host=e;break;case"host":i[t]=e,/:\d+$/.test(e)?(e=e.split(":"),i.port=e.pop(),i.hostname=e.join(":")):(i.hostname=e,i.port="");break;case"protocol":i.protocol=e.toLowerCase(),i.slashes=!r;break;case"pathname":case"hash":if(e){var o="pathname"===t?"/":"#";i[t]=e.charAt(0)!==o?o+e:e}else i[t]=e;break;default:i[t]=e}for(var u=0;u<a.length;u++){var l=a[u];l[4]&&(i[l[1]]=i[l[1]].toLowerCase())}return i.origin=i.protocol&&i.host&&"file:"!==i.protocol?i.protocol+"//"+i.host:"null",i.href=i.toString(),i},toString:function(t){t&&"function"==typeof t||(t=s.stringify);var e,r=this,n=r.protocol;n&&":"!==n.charAt(n.length-1)&&(n+=":");var i=n+(r.slashes?"//":"");return r.username&&(i+=r.username,r.password&&(i+=":"+r.password),i+="@"),i+=r.host+r.pathname,(e="object"==typeof r.query?t(r.query):r.query)&&(i+="?"!==e.charAt(0)?"?"+e:e),r.hash&&(i+=r.hash),i}},p.extractProtocol=h,p.location=l,p.qs=s,t.exports=p}).call(this,r(3))},function(t,e){t.exports=h,t.exports.parse=s,t.exports.compile=function(t,e){return i(s(t,e))},t.exports.tokensToFunction=i,t.exports.tokensToRegExp=l;var r="/",n=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function s(t,e){for(var s,i=[],u=0,l=0,h="",p=e&&e.delimiter||r,c=e&&e.whitelist||void 0,f=!1;null!==(s=n.exec(t));){var d=s[0],y=s[1],g=s.index;if(h+=t.slice(l,g),l=g+d.length,y)h+=y[1],f=!0;else{var w="",x=s[2],m=s[3],b=s[4],v=s[5];if(!f&&h.length){var T=h.length-1,j=h[T];(!c||c.indexOf(j)>-1)&&(w=j,h=h.slice(0,T))}h&&(i.push(h),h="",f=!1);var _="+"===v||"*"===v,q="?"===v||"*"===v,R=m||b,F=w||p;i.push({name:x||u++,prefix:w,delimiter:F,optional:q,repeat:_,pattern:R?a(R):"[^"+o(F===p?F:F+p)+"]+?"})}}return(h||l<t.length)&&i.push(h+t.substr(l)),i}function i(t){for(var e=new Array(t.length),r=0;r<t.length;r++)"object"==typeof t[r]&&(e[r]=new RegExp("^(?:"+t[r].pattern+")$"));return function(r,n){for(var s="",i=n&&n.encode||encodeURIComponent,o=0;o<t.length;o++){var a=t[o];if("string"!=typeof a){var u,l=r?r[a.name]:void 0;if(Array.isArray(l)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but got array');if(0===l.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var h=0;h<l.length;h++){if(u=i(l[h],a),!e[o].test(u))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'"');s+=(0===h?a.prefix:a.delimiter)+u}}else if("string"!=typeof l&&"number"!=typeof l&&"boolean"!=typeof l){if(!a.optional)throw new TypeError('Expected "'+a.name+'" to be '+(a.repeat?"an array":"a string"))}else{if(u=i(String(l),a),!e[o].test(u))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+u+'"');s+=a.prefix+u}}else s+=a}return s}}function o(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function a(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function u(t){return t&&t.sensitive?"":"i"}function l(t,e,n){for(var s=(n=n||{}).strict,i=!1!==n.start,a=!1!==n.end,l=n.delimiter||r,h=[].concat(n.endsWith||[]).map(o).concat("$").join("|"),p=i?"^":"",c=0;c<t.length;c++){var f=t[c];if("string"==typeof f)p+=o(f);else{var d=f.repeat?"(?:"+f.pattern+")(?:"+o(f.delimiter)+"(?:"+f.pattern+"))*":f.pattern;e&&e.push(f),f.optional?f.prefix?p+="(?:"+o(f.prefix)+"("+d+"))?":p+="("+d+")?":p+=o(f.prefix)+"("+d+")"}}if(a)s||(p+="(?:"+o(l)+")?"),p+="$"===h?"$":"(?="+h+")";else{var y=t[t.length-1],g="string"==typeof y?y[y.length-1]===l:void 0===y;s||(p+="(?:"+o(l)+"(?="+h+"))?"),g||(p+="(?="+o(l)+"|"+h+")")}return new RegExp(p,u(n))}function h(t,e,r){return t instanceof RegExp?function(t,e){if(!e)return t;var r=t.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return t}(t,e):Array.isArray(t)?function(t,e,r){for(var n=[],s=0;s<t.length;s++)n.push(h(t[s],e,r).source);return new RegExp("(?:"+n.join("|")+")",u(r))}(t,e,r):function(t,e,r){return l(s(t,r),e,r)}(t,e,r)}},function(e,r){e.exports=t},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";t.exports=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},function(t,e,r){"use strict";var n,s=Object.prototype.hasOwnProperty;function i(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}e.stringify=function(t,e){e=e||"";var r,i,o=[];for(i in"string"!=typeof e&&(e="?"),t)if(s.call(t,i)){if((r=t[i])||null!==r&&r!==n&&!isNaN(r)||(r=""),i=encodeURIComponent(i),r=encodeURIComponent(r),null===i||null===r)continue;o.push(i+"="+r)}return o.length?e+o.join("&"):""},e.parse=function(t){for(var e,r=/([^=?&]+)=?([^&]*)/g,n={};e=r.exec(t);){var s=i(e[1]),o=i(e[2]);null===s||null===o||s in n||(n[s]=o)}return n}},function(t,e,r){"use strict";function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}r.r(e);class s{constructor(t,e){n(this,"server",null),n(this,"body",null),n(this,"delay",0),n(this,"status",null),n(this,"statusText",null),n(this,"_headers",null),n(this,"wrapper",!1),this.server=t,this.delay=e.delay||t.delay,this.headers=e.headers||t.headers,this.status=e.status||t.status,this.statusText=e.statusText||t.statusText,this.wrapper=e.wrapper||t.wrapper,this.body=e.body||null,e.initialized instanceof Function&&(this.initialized=e.initialized),e.destroyed instanceof Function&&(this.destroyed=e.destroyed)}get headers(){return this._headers}set headers(t={}){return t instanceof Headers?(this._headers=t,this):(this._headers=new Headers(t),this)}get init(){return{delay:this.delay,headers:this.headers,status:this.status,statusText:this.statusText,wrapper:this.wrapper}}}var i=r(0),o=r.n(i),a=r(1),u=r.n(a),l=r(2),h=r.n(l);function p(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var c=class{constructor(t){p(this,"delay",0),p(this,"pattern",!1),p(this,"headers",new Headers({"content-type":"text/html"})),p(this,"status",200),p(this,"statusText","OK"),p(this,"wrapper",!1),p(this,"_call",null),p(this,"_stub",null),t&&this.configure(t)}configure(t={}){return this.setDelay(t.delay).setHeaders(t.headers).setStatus(t.status).setStatusText(t.statusText).setWrapper(t.wrapper).setFixturePattern(t.pattern),this}start(){return this.running||h.a.stub(window,"fetch"),this}stop(){return this.running&&window.fetch.restore(),this}reset(t=!1){return this.running&&t&&window.fetch.reset(),this.configure(),this}get running(){return window.fetch.reset instanceof Function}get stub(){if(this.running)return window.fetch;throw new Error("Server is not started")}requestToUrl(t){return o()(t.url,!0)}get request(){return this._argsToRequest(this.stub.lastCall.args)}get url(){return this.requestToUrl(this.request)}get query(){return this.url.query}_argsToRequest(t){return t[0]instanceof Request?t[0].clone():new Request(t[0],t[1])}get callCount(){return this.stub.callCount}getRequest(t){return this._argsToRequest(this.stub.getCall(t).args)}getAllRequests(){let t=[];for(let e=0;e<this.callCount;e++)t.push(this.getRequest(e));return t}setDelay(t=0){return this.delay=t,this}setStatus(t=200){return this.status=t,this}setStatusText(t="OK"){return this.statusText=t,this}setHeaders(t={"content-type":"text/html"}){return t instanceof Headers?(this.headers=t,this):(this.headers=new Headers(t),this)}setWrapper(t=!1){return this.wrapper=t,this}setFixturePattern(t){return this.pattern=t,this}get fixture(){let t=(this.pattern||this.url.pathname).split("/").filter(t=>t&&t.indexOf(":")<0),e=this.request.method.toLowerCase();return t.concat(e).join("/")}wrap(t,e){if(e){if(e instanceof Function)return e(t);if("string"==typeof t)return e.replace("%data%",t);let r=String(e);for(let e in t)r=r.replace("%"+e+"%",t[e]);return r}return t||null}onFirstCall(){return this.onCall(0)}onSecondCall(){return this.onCall(1)}onThirdCall(){return this.onCall(2)}onCall(t){return this._call=t,this}respondWith(t,e={}){let r=null!==this._call?this.stub.onCall(this._call):this.stub;return null!==this._call&&(e=Object.assign({delay:this.delay,headers:this.headers,status:this.status,statusText:this.statusText,wrapper:this.wrapper},e)),this._call=null,r.callsFake(()=>this._getResponse(t,e)),this}respondWithStatus(t,e){return this.respondWith(e,{status:t})}respondWithJSON(t,e={}){return e.headers=e.headers||new Headers,e.headers.set("content-type","application/json"),this.respondWith(JSON.stringify(t),e)}respondWithFixture(){let t=null!==this._call?this.stub.onCall(this._call):this.stub;return this._call=null,t.callsFake(this._loadFixture.bind(this)),this}async sleep(t){await new Promise(e=>setTimeout(e,t))}getFixtureParams(){try{let t=this._getFixtureParams();return console.warn("_getFixtureParams have been deprecated and will be removed in next versions. Please use getFixtureParams instead."),t}catch(t){throw new Response(null,{status:500,statusText:"Fixture loader have not been implemented. See readme for more informations."})}}async _loadFixture(t){let e;if(void 0===t)throw new Error("You must either provide a path or a fixture initialization object to fetch call");if("string"==typeof t)try{const e=this.getFixtureParams();t=new s(this,e)}catch(t){return t instanceof Response?t:new Response(null,{status:404,statusText:t.toString()})}else t=new s(this,t);let r={};if(this.pattern){const t=[],e=u()(this.pattern,t).exec(this.url.pathname);for(let n=0;n<t.length;n++)r[t[n].name]=e[n+1]}return t.initialized instanceof Function&&await t.initialized(r),this.delay&&await this.sleep(this.delay),e=await this._getResponse(t.body,t.init),t.destroyed instanceof Function&&await t.destroyed(),e}async _getResponse(t,e={}){let r;return t instanceof Response?(e=Object.assign({delay:this.delay},e),r=t):(e=Object.assign({delay:this.delay,headers:this.headers,status:this.status,statusText:this.statusText,wrapper:this.wrapper},e),t instanceof Function&&(t=t(this)),r=new Response(this.wrap(t,e.wrapper),e)),e.delay&&await this.sleep(e.delay),r.clone()}};r.d(e,"Fixture",function(){return s}),r.d(e,"Server",function(){return c});e.default=c}])});